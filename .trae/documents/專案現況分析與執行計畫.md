# 專案現況與執行計畫報告

## 1. 專案執行現況總覽

### 📊 進度與里程碑
*   **整體進度**: 🟢 **75%** (MVP 功能開發完成，進入驗證與優化階段)
*   **已完成里程碑 (M1 - M4)**:
    *   ✅ **環境建置**: Three.js + Vite + TypeScript 基礎架構。
    *   ✅ **編輯模式**: 體素放置、移除、存檔/讀檔 (JSON)、多種方塊類型。
    *   ✅ **遊玩模式**: 角色移動、跳躍、梯子攀爬、物理碰撞、陷阱重生機制。
    *   ✅ **核心機制**: 90度視角旋轉、投影碰撞 (Projection Collision)、鑰匙/門鎖系統、關卡進程管理。
    *   ✅ **程序化生成**: 基於種子 (Seed) 的隨機關卡生成器。
*   **當前階段**: **M5: MVP Release** (驗證測試、效能優化、發布)。

### 🚨 技術債與風險清單
根據《技術架構分析與優化報告》，目前存在以下關鍵問題：

| 類型 | 項目 | 嚴重度 | 說明 |
| :--- | :--- | :--- | :--- |
| **效能** | **Draw Calls 過高** | 🔥 極高 | 目前每個方塊皆為獨立 Mesh，大關卡會導致 FPS 驟降。需導入 `InstancedMesh`。 |
| **架構** | **God Class (GameManager)** | 🔴 高 | `GameManager` 職責過重（輸入、渲染、邏輯全包），維護成本高。 |
| **架構** | **高耦合度** | 🔴 高 | 系統間直接引用 (Direct Reference)，缺乏 Event Bus 解耦。 |
| **品質** | **缺乏自動化測試** | 🟡 中 | 無單元測試框架 (Vitest/Jest)，重構風險高。 |
| **安全** | **JSON 驗證不足** | 🟡 中 | 讀取存檔未做 Schema 驗證，有潛在 XSS 或崩潰風險。 |

### 👥 團隊成員與分工 (依文件推斷)
目前文件顯示角色多為 TBD，建議配置如下：
*   **Frontend Developer (主要)**: 負責核心邏輯、渲染優化、系統重構。
*   **QA / Tester**: 負責 MVP 三大測試場景驗證 (Infinite Loop, Broken Bridge, No Clipping)。
*   **Game Designer**: 負責設計教學關卡與調整程序化生成參數。

### 📉 品質指標
*   **程式碼覆蓋率**: N/A (目前無測試框架，覆蓋率為 0%)。
*   **缺陷密度**: 未知 (尚未正式 QA)，但已知存在效能瓶頸。
*   **文件完整度**: 高 (包含 PRD, Roadmap, Implementation Summary, 技術分析報告)。

---

## 2. 下一階段工作計畫 (本週與下週)

本階段核心目標：**「消除效能瓶頸，確保 MVP 穩定上線」**。

### 📅 本週 (Week 1): 效能重構與驗證
**目標**: 解決 Draw Call 效能問題，並完成 MVP 核心驗證。

| 工作項目 | 負責人 | 預估工時 | 驗收標準 (DoD) | 交付物 |
| :--- | :--- | :--- | :--- | :--- |
| **1. 實作 InstancedMesh 渲染** | Frontend | 3 天 | 1000+ 方塊場景下 Draw Calls < 50，FPS 穩定 60。 | 優化後的 `VoxelRenderer` 模組 |
| **2. 執行 MVP 驗證測試** | QA / Dev | 1 天 | 通過 Infinite Loop、Broken Bridge、No Clipping 三大測試。 | 測試報告 (含 Pass/Fail 紀錄) |
| **3. 建立基礎測試框架** | Frontend | 1 天 | 安裝 Vitest，完成 `LevelManager` 序列化功能的單元測試。 | `package.json` 更新，首個 `.test.ts` 檔 |
| **4. 修復已知 Bug** | Frontend | 1 天 | 修復測試中發現的 P0/P1 級錯誤。 | Bug Fix Commits |

**風險減緩**:
*   *InstancedMesh 重構風險*: 先在獨立分支 `feature/optimization` 進行，保留原版作為 fallback。

### 📅 下週 (Week 2): 架構解耦與發布準備
**目標**: 改善程式碼體質，完成部署準備。

| 工作項目 | 負責人 | 預估工時 | 驗收標準 (DoD) | 交付物 |
| :--- | :--- | :--- | :--- | :--- |
| **1. 實作 Event Bus 系統** | Frontend | 2 天 | UI 與 GameManager 不再直接引用，改透過事件溝通。 | `EventManager.ts`，重構後的 UI 邏輯 |
| **2. UI/UX 優化 (Polish)** | Designer | 2 天 | 加入操作提示、轉場動畫、Loading 畫面。 | 優化後的 CSS 與 UI Component |
| **3. 安全性增強 (Zod 驗證)** | Frontend | 1 天 | 讀取關卡時驗證 JSON Schema，過濾非法欄位。 | 安全的 `importLevel` 函式 |
| **4. 部署與文檔更新** | DevOps | 1 天 | 建立 GitHub Pages/Vercel 部署流程，更新 README。 | 線上 Demo 連結，使用手冊 |

**風險減緩**:
*   *重構導致的回歸錯誤*: 依賴本週建立的測試框架進行保護。

---

## 3. 立即行動建議
1.  **優先處理**: 啟動 `InstancedMesh` 優化任務，這是目前最大的技術瓶頸。
2.  **測試先行**: 在進行架構重構前，先為核心邏輯 (如 `LevelManager`) 補上測試。
3.  **驗證現況**: 請確認目前 `dist/` 下的建置版本是否可直接運行，以便進行初步的 MVP 驗證。
